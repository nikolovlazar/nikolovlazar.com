---
import { getCollection } from 'astro:content';
import { format } from 'timeago.js';

import Prose from '@/components/prose.astro';
import MainLayout from '@/layouts/main.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection("blog");

  return allPosts.filter(({ data}) => !data.isExternal).map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content, remarkPluginFrontmatter } = await post.render();
---

<MainLayout>
  <div class="title-container">
    <h1>{post.data.title}</h1>
    <hr />
    <div class="title-container--info">
      <time>{format(post.data.publishDate)}</time>
      <strong>{post.data.tags.map((tag: string) => tag)}</strong>
      <p>{Math.round(remarkPluginFrontmatter?.estReadingTime)} min read</p>
    </div>
  </div>
  <article>
    <Prose>
      <Content />
    </Prose>
  </article>
</MainLayout>

<style>
  h1 {
    font-size: var(--prose-h1);
  }
  .title-container--info {
    display: flex;
    justify-content: space-between;
    width: 100%;
  }
</style>
